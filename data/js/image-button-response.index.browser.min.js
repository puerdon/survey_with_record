var jsPsychImageButtonResponse=function(t){"use strict";function e(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var a={name:"image-button-response",parameters:{stimulus:{type:t.ParameterType.IMAGE,pretty_name:"Stimulus",default:void 0},stimulus_height:{type:t.ParameterType.INT,pretty_name:"Image height",default:null},stimulus_width:{type:t.ParameterType.INT,pretty_name:"Image width",default:null},maintain_aspect_ratio:{type:t.ParameterType.BOOL,pretty_name:"Maintain aspect ratio",default:!0},choices:{type:t.ParameterType.STRING,pretty_name:"Choices",default:void 0,array:!0},button_html:{type:t.ParameterType.HTML_STRING,pretty_name:"Button HTML",default:'<button class="jspsych-btn">%choice%</button>',array:!0},prompt:{type:t.ParameterType.HTML_STRING,pretty_name:"Prompt",default:null},prompt_above:{type:t.ParameterType.HTML_STRING,pretty_name:"Prompt above",default:null},stimulus_duration:{type:t.ParameterType.INT,pretty_name:"Stimulus duration",default:null},trial_duration:{type:t.ParameterType.INT,pretty_name:"Trial duration",default:null},margin_vertical:{type:t.ParameterType.STRING,pretty_name:"Margin vertical",default:"0px"},margin_horizontal:{type:t.ParameterType.STRING,pretty_name:"Margin horizontal",default:"8px"},response_ends_trial:{type:t.ParameterType.BOOL,pretty_name:"Response ends trial",default:!0},render_on_canvas:{type:t.ParameterType.BOOL,pretty_name:"Render on canvas",default:!0}}},i=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.jsPsych=e}var a,i,n;return a=t,(i=[{key:"trial",value:function(t,e){var a,i,n,r=this;if(e.render_on_canvas){var s=!1;if(t.hasChildNodes())for(;t.firstChild;)t.removeChild(t.firstChild);var l=document.createElement("canvas");l.id="jspsych-image-button-response-stimulus",l.style.margin="0",l.style.padding="0";var u=l.getContext("2d");(d=new Image).onload=function(){s||(o(),u.drawImage(d,0,0,i,a))},d.src=e.stimulus;var o=function(){null!==e.stimulus_height?(a=e.stimulus_height,null==e.stimulus_width&&e.maintain_aspect_ratio&&(i=d.naturalWidth*(e.stimulus_height/d.naturalHeight))):a=d.naturalHeight,null!==e.stimulus_width?(i=e.stimulus_width,null==e.stimulus_height&&e.maintain_aspect_ratio&&(a=d.naturalHeight*(e.stimulus_width/d.naturalWidth))):null!==e.stimulus_height&&e.maintain_aspect_ratio||(i=d.naturalWidth),l.height=a,l.width=i};o();var h=[];if(Array.isArray(e.button_html))e.button_html.length==e.choices.length?h=e.button_html:console.error("Error in image-button-response plugin. The length of the button_html array does not equal the length of the choices array");else for(var m=0;m<e.choices.length;m++)h.push(e.button_html);var c=document.createElement("div");for(c.id="jspsych-image-button-response-btngroup",n="",m=0;m<e.choices.length;m++){var p=h[m].replace(/%choice%/g,e.choices[m]);n+='<div class="jspsych-image-button-response-button" style="display: inline-block; margin:'+e.margin_vertical+" "+e.margin_horizontal+'" id="jspsych-image-button-response-button-'+m+'" data-choice="'+m+'">'+p+"</div>"}c.innerHTML=n,t.insertBefore(l,null),d.complete&&Number.isFinite(i)&&Number.isFinite(a)&&(u.drawImage(d,0,0,i,a),s=!0),t.insertBefore(c,l.nextElementSibling),null!==e.prompt&&t.insertAdjacentHTML("beforeend",e.prompt),null!==e.prompt_above&&t.insertAdjacentHTML("afterbegin",e.prompt_above)}else{if(n='<img src="'+e.stimulus+'" id="jspsych-image-button-response-stimulus">',h=[],Array.isArray(e.button_html))e.button_html.length==e.choices.length?h=e.button_html:console.error("Error in image-button-response plugin. The length of the button_html array does not equal the length of the choices array");else for(m=0;m<e.choices.length;m++)h.push(e.button_html);for(n+='<div id="jspsych-image-button-response-btngroup">',m=0;m<e.choices.length;m++)p=h[m].replace(/%choice%/g,e.choices[m]),n+='<div class="jspsych-image-button-response-button" style="display: inline-block; margin:'+e.margin_vertical+" "+e.margin_horizontal+'" id="jspsych-image-button-response-button-'+m+'" data-choice="'+m+'">'+p+"</div>";n+="</div>",null!==e.prompt&&(n+=e.prompt),null!==e.prompt_above&&(n=e.prompt_above+n),t.innerHTML=n;var d=t.querySelector("#jspsych-image-button-response-stimulus");null!==e.stimulus_height?(a=e.stimulus_height,null==e.stimulus_width&&e.maintain_aspect_ratio&&(i=d.naturalWidth*(e.stimulus_height/d.naturalHeight))):a=d.naturalHeight,null!==e.stimulus_width?(i=e.stimulus_width,null==e.stimulus_height&&e.maintain_aspect_ratio&&(a=d.naturalHeight*(e.stimulus_width/d.naturalWidth))):null!==e.stimulus_height&&e.maintain_aspect_ratio||(i=d.naturalWidth),d.style.height=a.toString()+"px",d.style.width=i.toString()+"px"}var y=performance.now();for(m=0;m<e.choices.length;m++)t.querySelector("#jspsych-image-button-response-button-"+m).addEventListener("click",(function(t){b(t.currentTarget.getAttribute("data-choice"))}));var _={rt:null,button:null},g=function(){r.jsPsych.pluginAPI.clearAllTimeouts();var a={rt:_.rt,stimulus:e.stimulus,response:_.button};t.innerHTML="",r.jsPsych.finishTrial(a)};function b(a){var i=performance.now(),n=Math.round(i-y);_.button=parseInt(a),_.rt=n,t.querySelector("#jspsych-image-button-response-stimulus").className+=" responded";for(var r=document.querySelectorAll(".jspsych-image-button-response-button button"),s=0;s<r.length;s++)r[s].setAttribute("disabled","disabled");e.response_ends_trial&&g()}null!==e.stimulus_duration&&this.jsPsych.pluginAPI.setTimeout((function(){t.querySelector("#jspsych-image-button-response-stimulus").style.visibility="hidden"}),e.stimulus_duration),null!==e.trial_duration?this.jsPsych.pluginAPI.setTimeout((function(){g()}),e.trial_duration):!1===e.response_ends_trial&&console.warn("The experiment may be deadlocked. Try setting a trial duration or set response_ends_trial to true.")}},{key:"simulate",value:function(t,e,a,i){"data-only"==e&&(i(),this.simulate_data_only(t,a)),"visual"==e&&this.simulate_visual(t,a,i)}},{key:"create_simulation_data",value:function(t,e){var a={stimulus:t.stimulus,rt:this.jsPsych.randomization.sampleExGaussian(500,50,1/150,!0),response:this.jsPsych.randomization.randomInt(0,t.choices.length-1)},i=this.jsPsych.pluginAPI.mergeSimulationData(a,e);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(t,i),i}},{key:"simulate_data_only",value:function(t,e){var a=this.create_simulation_data(t,e);this.jsPsych.finishTrial(a)}},{key:"simulate_visual",value:function(t,e,a){var i=this.create_simulation_data(t,e),n=this.jsPsych.getDisplayElement();this.trial(n,t),a(),null!==i.rt&&this.jsPsych.pluginAPI.clickTarget(n.querySelector('div[data-choice="'.concat(i.response,'"] button')),i.rt)}}])&&e(a.prototype,i),n&&e(a,n),Object.defineProperty(a,"prototype",{writable:!1}),t}();return i.info=a,i}(jsPsychModule);
